# LIA 프로젝트 리팩토링 계획

이 문서는 LIA 프로젝트의 `lib` 폴더 전체 코드를 분석하고, 코드 품질, 일관성, 유지보수성을 향상시키기 위한 리팩토링 계획을 제안합니다.

## 1. 전반적인 리팩토링 방향

- **일관성 강화**: `main_screen.dart`의 성공적인 UI/UX 패턴(번호가 매겨진 섹션, 일관된 카드 디자인 등)을 다른 화면(`ai_message_screen.dart`, `coaching_center_screen.dart`, `my_screen.dart`)에 확대 적용하여 앱 전체의 사용자 경험을 통일합니다.
- **위젯 재사용성 증대**: 여러 화면에서 중복으로 사용되는 UI 요소(예: 섹션 헤더, 카드 컨테이너)를 공용 위젯으로 추출하여 코드 중복을 줄이고 재사용성을 높입니다.
- **상태 관리 개선**: `StatefulWidget` 내에 혼재된 UI 로직과 비즈니스 로직을 분리하여 가독성과 테스트 용이성을 높입니다. (장기적으로 BLoC, Riverpod 등 상태 관리 라이브러리 도입 고려)
- **네이밍 및 주석 개선**: 파일, 클래스, 변수명의 역할을 명확히 하고, 복잡한 로직에는 `왜`에 초점을 맞춘 주석을 추가하여 코드 이해도를 높입니다.
- **디자인 시스템 정제**: `app_colors.dart`와 `app_text_styles.dart`에 중복되거나 사용되지 않는 스타일을 정리하고, 네이밍을 통일하여 디자인 시스템의 일관성을 강화합니다.

## 2. 파일별 리팩토링 계획

### 📄 `main.dart` 및 라우팅
- **(현상)** 라우팅 로직이 `main.dart`에 직접 정의되어 있고, 경로 이름이 문자열로 하드코딩되어 있어 오타에 취약하고 관리가 어렵습니다.
- **(계획)**
    - **라우팅 분리 및 상수화**: `core/routes/app_router.dart` 파일을 생성하여 모든 라우팅 로직을 중앙에서 관리하고, `app_routes.dart`에 `static const String home = '/';` 와 같이 경로 이름을 상수로 정의하여 타입 안정성을 확보합니다. (GoRouter 패키지 도입 고려)
    - **테마 분리**: `ThemeData` 설정을 `core/theme/app_theme.dart` 파일로 분리하여 테마 관련 코드를 체계적으로 관리합니다.

### 📂 `core/` - 디자인 시스템 및 상수
- **📄 `app_colors.dart`**
    - **(현상)** `charcoal`, `primaryText`, `textPrimary` 등 의미가 중복되는 색상 상수가 존재합니다.
    - **(계획)**
        - **중복 제거**: 의미가 같은 색상 상수를 하나로 통일하고, 가장 명확한 이름(예: `textPrimary`)으로 단일화합니다.
        - **사용처 분석**: 각 색상이 실제 UI에서 어떻게 사용되는지 추적하여 사용되지 않는 색상을 제거하거나, 용도에 맞는 이름으로 변경합니다. (예: `blue` → `info`, `green` → `success`)
- **📄 `app_text_styles.dart`**
    - **(현상)** `body`, `body1`, `body2`, `bodyMedium` 등 유사한 텍스트 스타일이 많아 혼란을 유발합니다.
    - **(계획)**
        - **스타일 통합**: 유사한 스타일을 통합하고, Material Design의 타입 시스템(예: `bodyLarge`, `bodyMedium`, `bodySmall`)을 참고하여 명확한 위계를 가진 타이포그래피 시스템으로 재정의합니다.
        - **네이밍 개선**: `h1`, `h2`와 같은 이름 대신 `headlineLarge`, `headlineMedium` 등 역할 기반의 이름으로 변경하여 가독성을 높입니다.
- **✨ (신규) `app_spacing.dart`**
    - **(현상)** `SizedBox(height: 16)`와 같이 UI 간격을 나타내는 매직 넘버가 코드 전반에 하드코딩되어 있습니다.
    - **(계획)**
        - **간격 상수화**: `core/constants/app_spacing.dart` 파일을 생성하여 `gapH16`, `gapW8` 등과 같이 반응형 간격 상수를 정의하여 레이아웃의 일관성을 확보하고 유지보수를 용이하게 합니다.

### 📂 `presentation/screens/`
- **(현상)** 각 화면의 전체적인 레이아웃과 섹션 구성 방식이 다릅니다. `main_screen.dart`의 번호 매겨진 섹션 스타일이 사용자에게 좋은 경험을 제공하고 있습니다.
- **(계획)**
    - **공용 위젯으로 UI 패턴 통일**: `_buildChartDemoSection`과 같은 섹션 빌더 위젯을 `common/section_card.dart`로, 대시보드 헤더를 `common/dashboard_header.dart`로 추출하여 모든 주요 화면에 일관되게 적용합니다.
- **(현상)** `analyzed_people_screen.dart`, `ai_message_screen.dart` 등 여러 화면 파일 내에 데이터 모델 클래스(`AnalyzedPerson`, `ToneOption` 등)가 직접 정의되어 있습니다.
- **(계획)**
    - **모델 클래스 완전 분리**: `data/models/` 디렉토리를 생성하고, 각 화면에 흩어져 있는 모든 모델 클래스를 각각의 파일로 분리하여 계층 구조를 개선하고 화면과 데이터의 의존성을 완전히 분리합니다.

### 📂 `presentation/widgets/`
- **📄 `lia_widgets.dart` (Barrel File)**
    - **(현상)** `export` 경로가 일부 누락되거나, 불필요한 위젯이 포함될 수 있습니다.
    - **(계획)**
        - **내보내기 최적화**: `lib` 폴더 전체를 분석하여 모든 공용 위젯이 `lia_widgets.dart`를 통해 `export` 되도록 경로를 최적화하고, 내부에서만 사용되는 위젯은 제외합니다.
- **📂 `specific/charts/`**
    - **(현상)** `BarChart`, `DonutChart` 등 모든 차트 위젯이 `StatefulWidget`과 `AnimationController`를 개별적으로 구현하고 있어, 보일러플레이트 코드가 중복됩니다.
    - **(계획)**
        - **차트 위젯 추상화**: `BaseChartWidget` 같은 추상 클래스를 만들어 애니메이션 컨트롤러 초기화, 데이터 파싱 등 공통 로직을 포함시키고, 각 차트는 이를 상속받아 고유한 `CustomPainter` 로직만 구현하도록 구조를 개선합니다.

### 📂 `services/`
- **📄 `analysis_data_service.dart`**
    - **(현상)** 데이터 모델 클래스가 서비스 파일 내에 함께 정의되어 있고, 오류 처리가 미흡합니다.
    - **(계획)**
        - **모델 분리**: `data/models/` 디렉토리로 모든 모델 클래스를 분리합니다.
        - **명시적인 오류 처리**: `try-catch` 문에서 `print` 대신 커스텀 예외를 던지거나 `Result` 타입을 사용하여 UI 레이어에서 명확한 오류 피드백을 줄 수 있도록 개선합니다.

### 🌍 `l10n/` - 다국어 지원 준비
- **(현상)** "메시지를 입력하세요", "분석 완료!" 등 사용자에게 보여지는 모든 텍스트가 코드에 직접 작성되어 있습니다.
- **(계획)**
    - **문자열 리소스 분리**: `l10n/` 디렉토리와 `.arb` 파일을 사용하여 모든 문자열을 분리합니다. 이를 통해 향후 다국어 지원이 용이해지고 텍스트의 중앙 관리가 가능해집니다.

## 3. 리팩토링 우선순위 및 실행 계획

### 🥇 높은 우선순위 (즉시 실행)
1.  **모델 클래스 분리**: `analysis_data_service.dart` 및 각 화면에 흩어져 있는 모델들을 `data/models/` 디렉토리로 분리.
2.  **디자인 시스템 정제**: `app_colors.dart`의 중복 색상 통합 및 `app_text_styles.dart`의 유사 스타일 통합.
3.  **공용 위젯 추출**: `SectionCard`, `DashboardHeader` 등 반복되는 UI 패턴을 `common` 위젯으로 추출.
4.  **`code_copy_card.dart` 이동**: `specific`에서 `common` 폴더로 이동.

### 🥈 중간 우선순위 (1주일 내)
1.  **UI 패턴 통일**: 추출된 공용 위젯을 `ai_message_screen.dart`, `coaching_center_screen.dart`, `my_screen.dart`에 적용.
2.  **라우팅 시스템 개선**: `app_router.dart` 및 `app_routes.dart`를 생성하여 라우팅 로직 분리 및 상수화.
3.  **간격 상수화**: `app_spacing.dart` 파일을 만들어 매직 넘버 제거.
4.  **`lia_widgets.dart` 최적화**: Barrel 파일의 `export` 목록 검토 및 정리.

### 🥉 낮은 우선순위 (장기적 관점)
1.  **차트 위젯 추상화**: `BaseChartWidget`을 도입하여 차트 관련 코드 중복 제거.
2.  **상태 관리 개선**: BLoC/Riverpod 같은 상태 관리 라이브러리 도입 준비.
3.  **서비스 레이어 개선**: 의존성 주입(DI) 준비 및 명시적 오류 처리 적용.
4.  **다국어 지원 준비**: `l10n`을 통한 문자열 리소스 분리.
5.  **성능 최적화**: 불필요한 리빌드 방지 및 캐싱 전략 개선.

## 4. 개발 환경 및 품질 관리 개선

### 🧪 테스트 전략 및 구조
- **(현상)** `test/` 폴더가 비어있고 테스트 코드가 전혀 없어 코드 품질 보장이 어렵습니다.
- **(계획)**
    - **테스트 구조 설정**: `test/unit/`, `test/widget/`, `test/integration/` 디렉토리 구조를 만들어 테스트 유형별로 분리합니다.
    - **위젯 테스트**: 모든 공통 위젯(`PrimaryButton`, `SectionCard` 등)에 대한 위젯 테스트 작성합니다.
    - **유닛 테스트**: `AnalysisDataService`, 모델 클래스들에 대한 유닛 테스트를 작성합니다.
    - **테스트 커버리지**: 최소 80% 이상의 테스트 커버리지를 목표로 합니다.

### 📦 의존성 관리 최적화
- **(현상)** 최소한의 의존성만 있고 버전 관리 전략이 부재하여 호환성 문제가 발생할 수 있습니다.
- **(계획)**
    - **의존성 버전 고정**: 주요 의존성의 버전을 고정하여 예측 가능한 빌드 환경을 보장합니다.
    - **보안 업데이트**: `flutter pub audit`을 통한 보안 취약점 검사 및 정기적인 의존성 업데이트 계획을 수립합니다.
    - **사용하지 않는 의존성 제거**: `flutter_staggered_animations`처럼 사용하지 않는 의존성을 정리합니다.

### 🎨 에셋 관리 개선
- **(현상)** 폰트 파일들이 `assets/fonts/`에 있지만 최적화되지 않고, 모든 폰트 웨이트를 로드하고 있습니다.
- **(계획)**
    - **폰트 최적화**: 실제 사용되는 폰트 웨이트만 로드하도록 `pubspec.yaml`을 최적화합니다.
    - **에셋 압축**: 폰트 파일과 이미지 파일을 압축하여 앱 크기를 줄입니다.
    - **조건부 로딩**: 필요한 경우에만 에셋을 로드하는 전략을 구현합니다.

### 📋 코드 품질 도구 강화
- **(현상)** 기본 `flutter_lints`만 사용하고 있어 코드 품질 관리가 느슨합니다.
- **(계획)**
    - **엄격한 린트 규칙**: `analysis_options.yaml`에 추가적인 린트 규칙을 적용합니다 (`prefer_single_quotes`, `avoid_print` 등).
    - **코드 포맷터**: `dart format`과 `import_sorter` 패키지를 사용하여 일관된 코드 스타일을 유지합니다.
    - **정적 분석 도구**: CI/CD 파이프라인에 `flutter analyze` 실행을 포함시켜 코드 품질을 자동으로 검사합니다.

### 🔒 보안 강화
- **(현상)** 보안 검토 없이 개발되어 잠재적 보안 취약점이 있을 수 있습니다.
- **(계획)**
    - **보안 린트 규칙**: 보안 관련 린트 규칙을 추가하여 잠재적 보안 문제를 사전에 방지합니다.
    - **민감한 정보 보호**: API 키, 토큰 등 민감한 정보를 환경 변수나 보안 저장소에 저장하는 구조를 마련합니다.
    - **네트워크 보안**: HTTPS 강제, 인증서 검증, 네트워크 보안 정책을 구현합니다.

### 📚 문서화 개선
- **(현상)** 기본 README만 있고 프로젝트 문서가 부족하여 새로운 개발자의 온보딩이 어렵습니다.
- **(계획)**
    - **API 문서**: `dartdoc`를 사용하여 모든 공개 API에 대한 문서를 자동 생성합니다.
    - **컴포넌트 가이드**: 각 위젯의 사용법과 예제를 포함한 컴포넌트 가이드를 작성합니다.
    - **개발 가이드**: 프로젝트 구조, 코딩 컨벤션, 배포 프로세스 등을 담은 개발 가이드를 작성합니다.
    - **CHANGELOG**: 버전별 변경사항을 추적할 수 있는 CHANGELOG.md 파일을 생성합니다.

### ♿ 접근성 개선
- **(현상)** 접근성 고려사항이 없어 시각 장애인이나 신체 장애인의 앱 사용이 어려울 수 있습니다.
- **(계획)**
    - **스크린 리더 지원**: 모든 위젯에 적절한 `semanticsLabel`과 `Tooltip`을 추가합니다.
    - **색상 대비**: WCAG 2.1 AA 기준을 만족하는 색상 대비를 확보합니다.
    - **키보드 네비게이션**: 키보드만으로도 모든 기능에 접근할 수 있도록 개선합니다.
    - **접근성 테스트**: `flutter test --enable-accessibility-assertions`를 통한 접근성 검증을 추가합니다.

### 🔧 개발 도구 및 워크플로우
- **(현상)** 개발 도구와 자동화된 워크플로우가 부족하여 개발 효율성이 떨어집니다.
- **(계획)**
    - **Pre-commit 훅**: 커밋 전에 린트 검사, 포맷팅, 테스트를 자동으로 실행하는 훅을 설정합니다.
    - **GitHub Actions**: CI/CD 파이프라인을 구성하여 자동 테스트, 빌드, 배포를 설정합니다.
    - **코드 리뷰 템플릿**: 일관된 코드 리뷰를 위한 템플릿을 제공합니다.
    - **이슈 템플릿**: 버그 리포트와 기능 요청을 위한 이슈 템플릿을 생성합니다.

### 📊 성능 모니터링
- **(현상)** 앱의 성능 지표를 추적하고 있지 않아 성능 문제를 사전에 발견하기 어렵습니다.
- **(계획)**
    - **성능 측정**: `flutter analyze --performance`를 통한 성능 분석을 정기적으로 수행합니다.
    - **메모리 사용량 모니터링**: 메모리 누수 방지를 위한 모니터링 도구를 도입합니다.
    - **앱 크기 최적화**: 번들 크기를 정기적으로 모니터링하고 최적화합니다.

## 5. 리팩토링 우선순위 재정의

### 🚨 최우선 (즉시 실행)
1. **코드 품질 도구 설정**: 린트 규칙 강화, 포맷터 설정
2. **테스트 구조 생성**: 기본 테스트 디렉토리 구조 및 몇 가지 핵심 테스트 작성
3. **모델 클래스 분리**: 현재 계획된 모델 분리 작업

### 🔥 높은 우선순위 (1주일 내)
1. **디자인 시스템 정제**: 색상/텍스트 스타일 통합
2. **공용 위젯 추출**: SectionCard, DashboardHeader 등
3. **문서화 개선**: README, API 문서 작성
4. **의존성 관리**: 버전 고정, 보안 업데이트

### 📈 중간 우선순위 (2주일 내)
1. **접근성 개선**: 기본적인 접근성 지원 추가
2. **보안 강화**: 보안 린트 규칙, 민감한 정보 보호
3. **성능 최적화**: 에셋 최적화, 메모리 사용량 개선

### 🎯 장기 우선순위 (1개월 내)
1. **CI/CD 파이프라인**: 자동화된 테스트, 빌드, 배포
2. **성능 모니터링**: 지속적인 성능 추적 시스템
3. **상태 관리 개선**: BLoC/Riverpod 도입

이 확장된 계획을 통해 LIA 프로젝트의 코드 베이스뿐만 아니라 전체 개발 환경과 품질을 종합적으로 향상시킬 수 있습니다.