<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>종합 API 토큰 비용 계산기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Roboto+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-color: #202124;
            --card-bg-color: #282a2d;
            --text-color: #e8eaed;
            --text-color-secondary: #bdc1c6;
            --border-color: #3c4043;
            --accent-color: #8ab4f8;
            --font-primary: 'Noto Sans KR', sans-serif;
            --font-mono: 'Roboto Mono', monospace;
            --cost-input-color: #4285F4;
            --cost-output-color: #34A853;
        }

        html.light {
            --bg-color: #f8f9fa;
            --card-bg-color: #ffffff;
            --text-color: #202124;
            --text-color-secondary: #5f6368;
            --border-color: #dadce0;
        }

        body {
            font-family: var(--font-primary);
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        .card {
            background-color: var(--card-bg-color);
            border: 1px solid var(--border-color);
        }

        select,
        input,
        textarea {
            background-color: var(--bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        select:focus,
        input:focus,
        textarea:focus {
            --tw-ring-color: var(--accent-color);
            border-color: var(--accent-color);
        }

        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23bdc1c6' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em 1.5em;
        }

        html.light select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%235f6368' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
        }
    </style>
    <script>
        if (localStorage.theme === 'light') {
            document.documentElement.classList.add('light');
        } else {
            document.documentElement.classList.remove('light');
        }
    </script>
</head>

<body>

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-5xl">
        <header class="relative text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-[var(--accent-color)]">종합 API 토큰 비용 계산기</h1>
            <p class="text-[var(--text-color-secondary)] mt-2">사용량과 모델에 따른 예상 API 비용을 계산해 보세요.</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- 입력 섹션 -->
            <div class="card p-6 rounded-xl shadow-md">
                <h2 class="text-2xl font-semibold mb-6 border-b pb-3 border-[var(--border-color)]">비용 계산기</h2>
                <div class="space-y-4">
                    <div>
                        <label for="model_select"
                            class="block text-sm font-medium text-[var(--text-color-secondary)] mb-1">API 모델 선택</label>
                        <select id="model_select" class="w-full px-3 py-2 rounded-lg">
                            <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                            <option value="gpt-4o">GPT-4o</option>
                            <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                            <option value="gemini-2.0-flash-lite">Gemini 2.0 Flash-Lite</option>
                            <option value="tiered">기존 모델 (계층형 요금)</option>
                        </select>
                    </div>
                    <div>
                        <label for="prompt_tokens"
                            class="block text-sm font-medium text-[var(--text-color-secondary)] mb-1">프롬프트 토큰 수</label>
                        <input type="number" id="prompt_tokens" value="27300" class="w-full px-3 py-2 rounded-lg">
                    </div>
                    <div>
                        <label for="output_tokens"
                            class="block text-sm font-medium text-[var(--text-color-secondary)] mb-1">출력 토큰 수</label>
                        <input type="number" id="output_tokens" value="10500" class="w-full px-3 py-2 rounded-lg">
                    </div>
                    <div id="tiered_options">
                        <div>
                            <label for="caching_hours"
                                class="block text-sm font-medium text-[var(--text-color-secondary)] mb-1">컨텍스트 캐싱 시간
                                (시간)</label>
                            <input type="number" id="caching_hours" value="0" class="w-full px-3 py-2 rounded-lg">
                        </div>
                        <div class="mt-4">
                            <label for="search_requests"
                                class="block text-sm font-medium text-[var(--text-color-secondary)] mb-1">Google 검색 요청
                                (일일)</label>
                            <input type="number" id="search_requests" value="1000" class="w-full px-3 py-2 rounded-lg">
                        </div>
                    </div>
                </div>
                <button id="calculateBtn"
                    class="mt-8 w-full bg-[var(--accent-color)] text-[var(--bg-color)] font-bold py-3 px-4 rounded-lg hover:opacity-90 transition-opacity duration-300">
                    비용 계산하기
                </button>
            </div>

            <!-- 결과 섹션 -->
            <div id="result" class="card p-6 rounded-xl shadow-md result-card">
                <h2 class="text-2xl font-semibold mb-6 border-b pb-3 border-[var(--border-color)]">예상 비용</h2>
                <div id="result-content" class="space-y-3">
                    <p class="text-center text-[var(--text-color-secondary)] mt-10">위의 값을 입력하고 '비용 계산하기' 버튼을 눌러주세요.</p>
                </div>
            </div>
        </div>

        <!-- 토큰 수 계산기 섹션 -->
        <div class="mt-10 card p-6 rounded-xl shadow-md">
            <h2 class="text-2xl font-semibold mb-4">간편 토큰 수 계산기</h2>
            <p class="text-sm text-[var(--text-color-secondary)] mb-4">프롬프트와 출력 텍스트를 입력하여 토큰 수를 계산하고 비용 계산기에 바로 적용하세요.
            </p>
            <div class="grid grid-cols-1 gap-6">
                <div>
                    <label for="system-prompt-input"
                        class="block text-sm font-medium text-[var(--text-color-secondary)] mb-2">시스템 프롬프트</label>
                    <textarea id="system-prompt-input" class="w-full h-24 p-3 rounded-lg font-mono text-sm"
                        placeholder="시스템 프롬프트를 입력하세요..."></textarea>

                    <label for="user-prompt-input"
                        class="block text-sm font-medium text-[var(--text-color-secondary)] mt-4 mb-2">사용자 프롬프트</label>
                    <textarea id="user-prompt-input" class="w-full h-24 p-3 rounded-lg font-mono text-sm"
                        placeholder="사용자 프롬프트를 입력하세요..."></textarea>
                </div>
                <div>
                    <label for="output-text-input"
                        class="block text-sm font-medium text-[var(--text-color-secondary)] mb-2">출력 텍스트</label>
                    <textarea id="output-text-input" class="w-full h-24 p-3 rounded-lg font-mono text-sm"
                        placeholder="예상 출력 텍스트를 입력하세요..."></textarea>
                </div>
            </div>
            <div
                class="mt-4 flex flex-col sm:flex-row items-center justify-between gap-4 bg-[var(--bg-color)] p-4 rounded-lg">
                <button id="count-token-btn"
                    class="w-full sm:w-auto bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-500 transition-colors duration-300">전체
                    토큰 수 계산</button>
                <div class="text-center flex-grow">
                    <div class="flex flex-wrap justify-center gap-x-4 gap-y-1 text-sm">
                        <span>시스템: <span id="system-token-count" class="font-semibold">0</span></span>
                        <span>사용자: <span id="user-token-count" class="font-semibold">0</span></span>
                        <span>출력: <span id="output-token-count" class="font-semibold">0</span></span>
                    </div>
                    <p class="mt-2">총 프롬프트 토큰: <span id="total-prompt-token-count"
                            class="font-bold text-[var(--accent-color)] text-lg">0</span></p>
                </div>
                <div class="flex gap-2">
                    <button id="apply-to-prompt-btn"
                        class="text-sm bg-blue-500/20 text-blue-300 font-semibold py-2 px-3 rounded-lg hover:bg-blue-500/30 transition-colors duration-300">프롬프트에
                        적용</button>
                    <button id="apply-to-output-btn"
                        class="text-sm bg-green-500/20 text-green-300 font-semibold py-2 px-3 rounded-lg hover:bg-green-500/30 transition-colors duration-300">출력에
                        적용</button>
                </div>
            </div>
            <p class="text-xs text-center text-[var(--text-color-secondary)] mt-2">※ 언어(한/영)를 감지하여 토큰을 예측하며, 실제와 다소 차이가
                있을 수 있습니다.</p>
        </div>

        <!-- 가격 정책 안내 -->
        <div class="mt-10 card p-6 rounded-xl shadow-md">
            <h3 class="text-xl font-semibold mb-4">가격 정책 요약</h3>
            <div class="space-y-6">
                <div>
                    <h4 class="font-semibold text-[var(--text-color-secondary)] mb-2">모델별 고정 요금 (1백만 토큰당)</h4>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-[var(--text-color-secondary)]">
                            <thead class="text-xs uppercase bg-[var(--bg-color)]">
                                <tr>
                                    <th scope="col" class="px-4 py-3">모델</th>
                                    <th scope="col" class="px-4 py-3">Input</th>
                                    <th scope="col" class="px-4 py-3">Output</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b border-[var(--border-color)]">
                                    <td class="px-4 py-2 font-medium">Gemini 2.0 Flash-Lite</td>
                                    <td class="px-4 py-2">$0.075</td>
                                    <td class="px-4 py-2">$0.30</td>
                                </tr>
                                <tr class="border-b border-[var(--border-color)]">
                                    <td class="px-4 py-2 font-medium">Gemini 2.5 Flash</td>
                                    <td class="px-4 py-2">$0.15</td>
                                    <td class="px-4 py-2">$0.60</td>
                                </tr>
                                <tr class="border-b border-[var(--border-color)]">
                                    <td class="px-4 py-2 font-medium">Gemini 2.5 Pro</td>
                                    <td class="px-4 py-2">$1.25</td>
                                    <td class="px-4 py-2">$10.00</td>
                                </tr>
                                <tr class="border-b border-[var(--border-color)]">
                                    <td class="px-4 py-2 font-medium">GPT-4o</td>
                                    <td class="px-4 py-2">$2.50</td>
                                    <td class="px-4 py-2">$10.00</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div>
                    <h4 class="font-semibold text-[var(--text-color-secondary)] mb-2">기존 모델 계층형 요금</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
                        <div class="bg-[var(--bg-color)] p-4 rounded-lg">
                            <h5 class="font-bold text-[var(--cost-input-color)] mb-2">입력 (프롬프트)</h5>
                            <ul class="list-disc list-inside space-y-1">
                                <li>20만 토큰 이하: $1.25 / 1백만 토큰</li>
                                <li>20만 토큰 초과: $2.50 / 1백만 토큰</li>
                            </ul>
                        </div>
                        <div class="bg-[var(--bg-color)] p-4 rounded-lg">
                            <h5 class="font-bold text-[var(--cost-output-color)] mb-2">출력 (생성)</h5>
                            <ul class="list-disc list-inside space-y-1">
                                <li>프롬프트 ≤ 20만: $10.00 / 1백만 토큰</li>
                                <li>프롬프트 > 20만: $15.00 / 1백만 토큰</li>
                            </ul>
                        </div>
                        <div class="bg-[var(--bg-color)] p-4 rounded-lg">
                            <h5 class="font-bold text-purple-400 mb-2">컨텍스트 캐싱</h5>
                            <ul class="list-disc list-inside space-y-1">
                                <li>스토리지: $4.50 / 시간당 1백만 토큰</li>
                            </ul>
                        </div>
                        <div class="bg-[var(--bg-color)] p-4 rounded-lg">
                            <h5 class="font-bold text-red-400 mb-2">Google 검색 그라운딩</h5>
                            <ul class="list-disc list-inside space-y-1">
                                <li>일일 1,500 요청까지 무료</li>
                                <li>초과 시: $35.00 / 1,000 요청</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CALCULATOR SCRIPT ---
        const modelSelect = document.getElementById('model_select');
        const calculateBtn = document.getElementById('calculateBtn');
        const resultDiv = document.getElementById('result');
        const resultContent = document.getElementById('result-content');
        const tieredOptionsDiv = document.getElementById('tiered_options');
        const promptTokensInput = document.getElementById('prompt_tokens');
        const outputTokensInput = document.getElementById('output_tokens');

        const systemPromptInput = document.getElementById('system-prompt-input');
        const userPromptInput = document.getElementById('user-prompt-input');
        const outputTextInput = document.getElementById('output-text-input');
        const countTokenBtn = document.getElementById('count-token-btn');
        const systemTokenCountSpan = document.getElementById('system-token-count');
        const userTokenCountSpan = document.getElementById('user-token-count');
        const outputTokenCountSpan = document.getElementById('output-token-count');
        const totalPromptTokenCountSpan = document.getElementById('total-prompt-token-count');
        const applyToPromptBtn = document.getElementById('apply-to-prompt-btn');
        const applyToOutputBtn = document.getElementById('apply-to-output-btn');

        const PROMPT_THRESHOLD = 200000;
        const SEARCH_FREE_LIMIT = 1500;

        const PRICING = {
            'tiered': {
                prompt: { low: 1.25, high: 2.50 },
                output: { low: 10.00, high: 15.00 },
                caching: 4.50,
                search: 35.00
            },
            'gemini-2.0-flash-lite': { prompt: 0.075, output: 0.30 },
            'gemini-2.5-flash': { prompt: 0.15, output: 0.60 },
            'gemini-2.5-pro': { prompt: 1.25, output: 10.00 },
            'gpt-4o': { prompt: 2.50, output: 10.00 }
        };

        const systemPromptData = ``;

        const userPromptData = ``;

        const outputTextData = ``;

        function populateData() {
            systemPromptInput.value = systemPromptData;
            userPromptInput.value = userPromptData;
            outputTextInput.value = outputTextData;
        }


        function toggleTieredOptions() {
            tieredOptionsDiv.style.display = modelSelect.value === 'tiered' ? 'block' : 'none';
        }

        function calculateCost() {
            const selectedModel = modelSelect.value;
            const prices = PRICING[selectedModel];

            const promptTokens = parseInt(promptTokensInput.value) || 0;
            const outputTokens = parseInt(outputTokensInput.value) || 0;

            let totalCost = 0;
            let breakdown = `<div class="text-center font-semibold mb-2 text-[var(--accent-color)]">${modelSelect.options[modelSelect.selectedIndex].text} 기준</div>`;

            let promptCost = 0;
            let outputCost = 0;

            if (selectedModel === 'tiered') {
                const promptRate = promptTokens <= PROMPT_THRESHOLD ? prices.prompt.low : prices.prompt.high;
                promptCost = (promptTokens / 1000000) * promptRate;

                const outputRate = promptTokens <= PROMPT_THRESHOLD ? prices.output.low : prices.output.high;
                outputCost = (outputTokens / 1000000) * outputRate;

                breakdown += `
                    <div class="flex justify-between items-center py-2 border-b border-[var(--border-color)]">
                        <span class="text-[var(--text-color-secondary)]">입력 비용:</span>
                        <span class="font-semibold text-[var(--cost-input-color)]">$${promptCost.toFixed(4)}</span>
                    </div>
                    <p class="text-xs text-right text-[var(--text-color-secondary)] -mt-1 mb-2">(${promptTokens.toLocaleString()} 토큰 * $${promptRate}/1M)</p>
                `;
                breakdown += `
                    <div class="flex justify-between items-center py-2 border-b border-[var(--border-color)]">
                        <span class="text-[var(--text-color-secondary)]">출력 비용:</span>
                        <span class="font-semibold text-[var(--cost-output-color)]">$${outputCost.toFixed(4)}</span>
                    </div>
                    <p class="text-xs text-right text-[var(--text-color-secondary)] -mt-1 mb-2">(${outputTokens.toLocaleString()} 토큰 * $${outputRate}/1M)</p>
                `;

                const cachingHours = parseFloat(document.getElementById('caching_hours').value) || 0;
                let cachingCost = 0;
                if (cachingHours > 0 && promptTokens > 0) {
                    cachingCost = (promptTokens / 1000000) * cachingHours * prices.caching;
                }
                totalCost += cachingCost;
                breakdown += `
                    <div class="flex justify-between items-center py-2 border-b border-[var(--border-color)]">
                        <span class="text-[var(--text-color-secondary)]">캐싱 비용:</span>
                        <span class="font-semibold text-purple-400">$${cachingCost.toFixed(4)}</span>
                    </div>
                    <p class="text-xs text-right text-[var(--text-color-secondary)] -mt-1 mb-2">(${cachingHours.toLocaleString()} 시간, 스토리지)</p>
                `;

                const searchRequests = parseInt(document.getElementById('search_requests').value) || 0;
                let searchCost = 0;
                let chargeableRequests = 0;
                if (searchRequests > SEARCH_FREE_LIMIT) {
                    chargeableRequests = searchRequests - SEARCH_FREE_LIMIT;
                    searchCost = (chargeableRequests / 1000) * prices.search;
                }
                totalCost += searchCost;
                breakdown += `
                    <div class="flex justify-between items-center py-2 border-b border-[var(--border-color)]">
                        <span class="text-[var(--text-color-secondary)]">검색 비용:</span>
                        <span class="font-semibold text-red-400">$${searchCost.toFixed(4)}</span>
                    </div>
                    <p class="text-xs text-right text-[var(--text-color-secondary)] -mt-1 mb-2">(${chargeableRequests.toLocaleString()} 유료 요청)</p>
                `;

            } else {
                promptCost = (promptTokens / 1000000) * prices.prompt;
                outputCost = (outputTokens / 1000000) * prices.output;

                breakdown += `
                    <div class="flex justify-between items-center py-2 border-b border-[var(--border-color)]">
                        <span class="text-[var(--text-color-secondary)]">입력 비용:</span>
                        <span class="font-semibold text-[var(--cost-input-color)]">$${promptCost.toFixed(4)}</span>
                    </div>
                    <p class="text-xs text-right text-[var(--text-color-secondary)] -mt-1 mb-2">(${promptTokens.toLocaleString()} 토큰 * $${prices.prompt}/1M)</p>
                `;
                breakdown += `
                    <div class="flex justify-between items-center py-2 border-b border-[var(--border-color)]">
                        <span class="text-[var(--text-color-secondary)]">출력 비용:</span>
                        <span class="font-semibold text-[var(--cost-output-color)]">$${outputCost.toFixed(4)}</span>
                    </div>
                    <p class="text-xs text-right text-[var(--text-color-secondary)] -mt-1 mb-2">(${outputTokens.toLocaleString()} 토큰 * $${prices.output}/1M)</p>
                `;
                breakdown += `<p class="text-xs text-center text-[var(--text-color-secondary)] pt-4">캐싱 및 검색 비용은 이 모델에 적용되지 않습니다.</p>`;
            }

            totalCost += promptCost + outputCost;

            breakdown += `
                <div class="mt-6 pt-4 border-t-2 border-dashed border-[var(--border-color)]">
                    <div class="flex justify-between items-center text-xl">
                        <span class="font-bold">총 예상 비용:</span>
                        <span class="font-bold text-[var(--accent-color)]">$${totalCost.toFixed(4)}</span>
                    </div>
                </div>
            `;

            resultContent.innerHTML = breakdown;
            resultDiv.classList.add('show');
        }

        function estimateTokens(text) {
            if (!text) return 0;
            const koreanRegex = /[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/;
            const hasKorean = koreanRegex.test(text);

            if (hasKorean) {
                return Math.round(text.length * 1.4);
            } else {
                return Math.round(text.length * 0.25);
            }
        }

        function calculateAllTokens() {
            const systemText = systemPromptInput.value;
            const userText = userPromptInput.value;
            const outputText = outputTextInput.value;

            const systemTokens = estimateTokens(systemText);
            const userTokens = estimateTokens(userText);
            const outputTokens = estimateTokens(outputText);
            const totalPromptTokens = systemTokens + userTokens;

            systemTokenCountSpan.textContent = systemTokens.toLocaleString();
            userTokenCountSpan.textContent = userTokens.toLocaleString();
            outputTokenCountSpan.textContent = outputTokens.toLocaleString();
            totalPromptTokenCountSpan.textContent = totalPromptTokens.toLocaleString();
        }

        modelSelect.addEventListener('change', () => {
            toggleTieredOptions();
            calculateCost();
        });
        calculateBtn.addEventListener('click', calculateCost);

        countTokenBtn.addEventListener('click', calculateAllTokens);

        applyToPromptBtn.addEventListener('click', () => {
            promptTokensInput.value = totalPromptTokenCountSpan.textContent.replace(/,/g, '');
            calculateCost();
        });

        applyToOutputBtn.addEventListener('click', () => {
            outputTokensInput.value = outputTokenCountSpan.textContent.replace(/,/g, '');
            calculateCost();
        });

        window.addEventListener('load', () => {
            populateData();
            calculateAllTokens();
            promptTokensInput.value = totalPromptTokenCountSpan.textContent.replace(/,/g, '');
            outputTokensInput.value = outputTokenCountSpan.textContent.replace(/,/g, '');
            toggleTieredOptions();
            calculateCost();
        });
    </script>

</body>

</html>